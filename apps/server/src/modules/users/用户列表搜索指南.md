# ç”¨æˆ·åˆ—è¡¨æœç´¢æŒ‡å—

## æ¦‚è¿°

ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢æ¥å£ `GET /users` æä¾›äº†å¼ºå¤§çš„é«˜çº§æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æœç´¢æ¨¡å¼ã€æ“ä½œç¬¦å’Œç­›é€‰æ¡ä»¶ã€‚æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™äº›åŠŸèƒ½è¿›è¡Œç²¾ç¡®çš„ç”¨æˆ·æ•°æ®æŸ¥è¯¢ã€‚

## ğŸ¯ åŸºç¡€æœç´¢å‚æ•°

### å…¨å±€æœç´¢

åœ¨å§“åã€é‚®ç®±ã€æ‰‹æœºå·ä¸­æœç´¢å…³é”®è¯ï¼š

```bash
# æœç´¢åŒ…å« "leoku" çš„ç”¨æˆ·
GET /users?search=leoku

# æœç´¢åŒ…å«é‚®ç®±å…³é”®è¯çš„ç”¨æˆ·
GET /users?search=admin@example.com

# æœç´¢åŒ…å«æ‰‹æœºå·çš„ç”¨æˆ·
GET /users?search=138
```

### å­—æ®µç²¾ç¡®æœç´¢

é’ˆå¯¹ç‰¹å®šå­—æ®µè¿›è¡Œæœç´¢ï¼š

```bash
# å•å­—æ®µæœç´¢
GET /users?name=å¼ ä¸‰
GET /users?email=admin@example.com
GET /users?phone=13800138000

# å¤šå­—æ®µç»„åˆæœç´¢ï¼ˆAND æ“ä½œï¼Œé»˜è®¤ï¼‰
GET /users?name=å¼ &email=admin

# å¤šå­—æ®µç»„åˆæœç´¢ï¼ˆOR æ“ä½œï¼‰
GET /users?name=å¼ &email=admin&operator=or
```

## ğŸš€ é«˜çº§æœç´¢æ“ä½œç¬¦

### å­—ç¬¦ä¸²å­—æ®µæ“ä½œç¬¦

é€‚ç”¨äº `name`ã€`email`ã€`phone` å­—æ®µï¼š

#### åŸºç¡€åŒ¹é…

```bash
# ç­‰äº
GET /users?name[eq]=å¼ ä¸‰

# ä¸ç­‰äº
GET /users?name[neq]=ç®¡ç†å‘˜

# åŒ…å«å­å­—ç¬¦ä¸²
GET /users?name[contains]=å¼ 
GET /users?email[contains]=@company.com

# ä»¥...å¼€å§‹
GET /users?name[startsWith]=æ
GET /users?email[startsWith]=admin

# ä»¥...ç»“æŸ
GET /users?name[endsWith]=ä¸‰
GET /users?email[endsWith]=@gmail.com
```

#### é«˜çº§åŒ¹é…

```bash
# æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
GET /users?email[regex]=.*@(gmail|qq)\.com
GET /users?phone[regex]=^1[3-9]\d{9}$

# ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…
GET /users?name[ilike]=ADMIN
GET /users?email[ilike]=TEST@EXAMPLE.COM
```

#### æ•°ç»„æ“ä½œ

```bash
# åŒ…å«ï¼ˆæ•°ç»„ï¼‰
GET /users?name[in]=å¼ ä¸‰,æå››,ç‹äº”
GET /users?email[in]=admin@test.com,user@test.com

# ä¸åŒ…å«ï¼ˆæ•°ç»„ï¼‰
GET /users?name[notIn]=æµ‹è¯•ç”¨æˆ·,ä¸´æ—¶ç”¨æˆ·
```

#### ç©ºå€¼åˆ¤æ–­

```bash
# å­—æ®µä¸ºç©º
GET /users?phone[isNull]=true

# å­—æ®µä¸ä¸ºç©º
GET /users?phone[isNotNull]=true
```

### å¸ƒå°”å­—æ®µæ“ä½œç¬¦

é€‚ç”¨äº `isActive` å­—æ®µï¼š

```bash
# åŸºç¡€å¸ƒå°”æœç´¢
GET /users?isActive=true
GET /users?isActive=false

# é«˜çº§å¸ƒå°”æ“ä½œç¬¦
GET /users?isActive[eq]=true
GET /users?isActive[neq]=false

# ç©ºå€¼åˆ¤æ–­
GET /users?isActive[isNull]=true
GET /users?isActive[isNotNull]=true
```

### æ—¥æœŸå­—æ®µæ“ä½œç¬¦

é€‚ç”¨äº `createdAt`ã€`updatedAt` å­—æ®µï¼š

#### æ—¥æœŸæ¯”è¾ƒ

```bash
# å¤§äºç­‰äº
GET /users?createdAt[gte]=2024-01-01
GET /users?createdAt[gte]=2024-01-01T00:00:00Z

# å°äºç­‰äº
GET /users?createdAt[lte]=2024-12-31
GET /users?updatedAt[lte]=2024-12-31T23:59:59Z

# å¤§äº
GET /users?updatedAt[gt]=2024-06-01T00:00:00Z

# å°äº
GET /users?createdAt[lt]=2024-06-01
```

#### æ—¥æœŸèŒƒå›´

```bash
# èŒƒå›´æŸ¥è¯¢ï¼ˆåŒ…å«è¾¹ç•Œï¼‰
GET /users?createdAt[between]=2024-01-01,2024-12-31
GET /users?updatedAt[between]=2024-06-01T00:00:00Z,2024-06-30T23:59:59Z
```

#### æ—¥æœŸç²¾ç¡®åŒ¹é…

```bash
# ç­‰äº
GET /users?createdAt[eq]=2024-01-15
GET /users?createdAt[eq]=2024-01-15T10:30:00Z

# ä¸ç­‰äº
GET /users?updatedAt[neq]=2024-01-01
```

## ğŸ“Š æœç´¢æ¨¡å¼

ç³»ç»Ÿæ”¯æŒæ™ºèƒ½æœç´¢æ¨¡å¼åˆ¤æ–­ï¼Œä¹Ÿå¯æ‰‹åŠ¨æŒ‡å®šï¼š

### æ™ºèƒ½åˆ¤æ–­ï¼ˆæ¨èï¼‰

```bash
# è‡ªåŠ¨ä½¿ç”¨å…¨å±€æœç´¢
GET /users?search=admin

# è‡ªåŠ¨ä½¿ç”¨ç²¾ç¡®æœç´¢
GET /users?name=å¼ ä¸‰

# è‡ªåŠ¨ä½¿ç”¨ç»„åˆæœç´¢
GET /users?search=admin&name=å¼ 

# è‡ªåŠ¨ä½¿ç”¨é«˜çº§æœç´¢
GET /users?name[contains]=å¼ 
```

### æ‰‹åŠ¨æŒ‡å®šæœç´¢æ¨¡å¼

```bash
# å…¨å±€æœç´¢æ¨¡å¼
GET /users?search=admin&searchMode=global

# ç²¾ç¡®æœç´¢æ¨¡å¼
GET /users?name=å¼ ä¸‰&searchMode=exact

# ç»„åˆæœç´¢æ¨¡å¼
GET /users?search=admin&name=å¼ &searchMode=combined

# é«˜çº§æœç´¢æ¨¡å¼
GET /users?name[regex]=^A.*&searchMode=advanced
```

### æœç´¢æ¨¡å¼è¯´æ˜

- **global**: åœ¨å§“åã€é‚®ç®±ã€æ‰‹æœºå·ä¸­è¿›è¡Œæ¨¡ç³ŠåŒ¹é…
- **exact**: åªåœ¨æŒ‡å®šå­—æ®µä¸­è¿›è¡Œæœç´¢
- **combined**: å…¨å±€æœç´¢ä¸å­—æ®µæœç´¢çš„æ™ºèƒ½ç»„åˆ
- **advanced**: ä½¿ç”¨æ“ä½œç¬¦è¿›è¡Œå¤æ‚æ¡ä»¶æŸ¥è¯¢

## ğŸ”„ æ’åºåŠŸèƒ½

### å•å­—æ®µæ’åº

```bash
# æŒ‰å§“åå‡åº
GET /users?sortBy=name&sortOrder=asc

# æŒ‰åˆ›å»ºæ—¶é—´é™åºï¼ˆé»˜è®¤ï¼‰
GET /users?sortBy=createdAt&sortOrder=desc

# æŒ‰é‚®ç®±å‡åº
GET /users?sortBy=email&sortOrder=asc

# æŒ‰æ›´æ–°æ—¶é—´é™åº
GET /users?sortBy=updatedAt&sortOrder=desc
```

### å¤šå­—æ®µæ’åº

```bash
# å…ˆæŒ‰å§“åå‡åºï¼Œå†æŒ‰åˆ›å»ºæ—¶é—´é™åº
GET /users?sortBy=[{"field":"name","order":"asc"},{"field":"createdAt","order":"desc"}]

# å…ˆæŒ‰æ´»è·ƒçŠ¶æ€é™åºï¼Œå†æŒ‰å§“åå‡åºï¼Œæœ€åæŒ‰åˆ›å»ºæ—¶é—´é™åº
GET /users?sortBy=[{"field":"isActive","order":"desc"},{"field":"name","order":"asc"},{"field":"createdAt","order":"desc"}]

# å¤šå­—æ®µæ’åºç»“åˆæœç´¢
GET /users?search=admin&sortBy=[{"field":"email","order":"asc"},{"field":"updatedAt","order":"desc"}]
```

### æ’åºå‚æ•°æ ¼å¼

#### å•å­—æ®µæ ¼å¼

- `sortBy`: å­—æ®µåï¼ˆå­—ç¬¦ä¸²ï¼‰
- `sortOrder`: `asc`ï¼ˆå‡åºï¼‰æˆ– `desc`ï¼ˆé™åºï¼‰

#### å¤šå­—æ®µæ ¼å¼

- `sortBy`: JSON å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ ¼å¼ï¼š`[{"field":"å­—æ®µå","order":"æ’åºæ–¹å‘"}]`
- æ’åºä¼˜å…ˆçº§ï¼šæ•°ç»„ä¸­è¶Šé å‰çš„å­—æ®µä¼˜å…ˆçº§è¶Šé«˜

### æ”¯æŒçš„æ’åºå­—æ®µ

- `name`: ç”¨æˆ·å§“å
- `email`: é‚®ç®±åœ°å€
- `phone`: æ‰‹æœºå·ç 
- `isActive`: æ´»è·ƒçŠ¶æ€
- `createdAt`: åˆ›å»ºæ—¶é—´ï¼ˆé»˜è®¤ï¼‰
- `updatedAt`: æ›´æ–°æ—¶é—´

### æ’åºæ–¹å‘

- `asc`: å‡åº
- `desc`: é™åºï¼ˆé»˜è®¤ï¼‰

## ğŸ“„ åˆ†é¡µå‚æ•°

```bash
# åŸºç¡€åˆ†é¡µ
GET /users?page=1&pageSize=10

# å¤§é¡µé¢
GET /users?page=2&pageSize=20

# æœç´¢ + åˆ†é¡µ
GET /users?search=admin&page=1&pageSize=10

# é«˜çº§æœç´¢ + åˆ†é¡µ
GET /users?name[contains]=å¼ &isActive=true&page=1&pageSize=15
```

### åˆ†é¡µå‚æ•°è¯´æ˜

- `page`: é¡µç ï¼Œä» 1 å¼€å§‹ï¼ˆé»˜è®¤ï¼š1ï¼‰
- `pageSize`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ï¼š10ï¼‰

## ğŸ¯ å¤æ‚æŸ¥è¯¢ç¤ºä¾‹

### ç»¼åˆæŸ¥è¯¢

```bash
# å¤æ‚ç»„åˆæŸ¥è¯¢
GET /users?search=admin&name[startsWith]=å¼ &email[contains]=@company.com&isActive=true&createdAt[gte]=2024-01-01&sortBy=createdAt&sortOrder=desc&page=1&pageSize=20
```

### å®é™…ä¸šåŠ¡åœºæ™¯

#### æŸ¥æ‰¾ç‰¹å®šæ—¶é—´æ®µæ³¨å†Œçš„æ´»è·ƒç”¨æˆ·

```bash
GET /users?createdAt[between]=2024-01-01,2024-06-30&isActive=true&sortBy=name&sortOrder=asc
```

#### æŸ¥æ‰¾é‚®ç®±ç¬¦åˆç‰¹å®šæ¨¡å¼çš„ç”¨æˆ·

```bash
GET /users?email[regex]=.*@(gmail|qq)\.com&isActive=true&sortBy=createdAt&sortOrder=desc
```

#### æŸ¥æ‰¾æœ€è¿‘æ›´æ–°çš„ç”¨æˆ·

```bash
GET /users?updatedAt[gte]=2024-11-01&sortBy=updatedAt&sortOrder=desc&pageSize=20
```

#### æŸ¥æ‰¾å§“ååŒ…å«ç‰¹å®šå­—ç¬¦çš„éæ´»è·ƒç”¨æˆ·

```bash
GET /users?name[contains]=æµ‹è¯•&isActive=false&sortBy=createdAt&sortOrder=asc
```

#### æŸ¥æ‰¾æ‰‹æœºå·ä¸ºç©ºçš„ç”¨æˆ·

```bash
GET /users?phone[isNull]=true&sortBy=createdAt&sortOrder=desc
```

#### æŸ¥æ‰¾ç‰¹å®šé‚®ç®±åŸŸåçš„ç”¨æˆ·

```bash
GET /users?email[endsWith]=@company.com&isActive=true&createdAt[gte]=2024-01-01
```

#### å¤šå­—æ®µæ’åºçš„å¤æ‚æŸ¥è¯¢ç¤ºä¾‹

```bash
# æŸ¥æ‰¾æ´»è·ƒç”¨æˆ·ï¼ŒæŒ‰çŠ¶æ€ã€å§“åã€åˆ›å»ºæ—¶é—´å¤šé‡æ’åº
GET /users?isActive=true&sortBy=[{"field":"isActive","order":"desc"},{"field":"name","order":"asc"},{"field":"createdAt","order":"desc"}]

# æœç´¢ç‰¹å®šå…³é”®è¯çš„ç”¨æˆ·ï¼ŒæŒ‰é‚®ç®±å’Œæ›´æ–°æ—¶é—´æ’åº
GET /users?search=admin&sortBy=[{"field":"email","order":"asc"},{"field":"updatedAt","order":"desc"}]

# æ—¥æœŸèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰å¤šå­—æ®µæ’åº
GET /users?createdAt[between]=2024-01-01,2024-06-30&sortBy=[{"field":"updatedAt","order":"desc"},{"field":"name","order":"asc"}]

# å¤æ‚æ¡ä»¶ç»„åˆæŸ¥è¯¢ï¼Œå¤šå­—æ®µæ’åº
GET /users?name[contains]=å¼ &email[endsWith]=@company.com&isActive=true&sortBy=[{"field":"phone","order":"asc"},{"field":"createdAt","order":"desc"}]&page=1&pageSize=20
```

## ğŸ“‹ å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "data": [
    {
      "id": "uuid",
      "name": "leoku",
      "email": "leoku@example.com",
      "phone": "13800138000",
      "isActive": true,
      "createdAt": "2023-01-01T00:00:00.000Z",
      "updatedAt": "2023-01-01T00:00:00.000Z"
    }
  ],
  "pagination": {
    "total": 1,
    "page": 1,
    "pageSize": 10,
    "totalPages": 1,
    "hasNextPage": false,
    "hasPrevPage": false
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

#### ç”¨æˆ·æ•°æ®å­—æ®µ

- `id`: ç”¨æˆ·å”¯ä¸€æ ‡è¯†
- `name`: ç”¨æˆ·å§“å
- `email`: é‚®ç®±åœ°å€
- `phone`: æ‰‹æœºå·ç 
- `isActive`: ç”¨æˆ·çŠ¶æ€ï¼ˆtrue: æ´»è·ƒï¼Œfalse: éæ´»è·ƒï¼‰
- `createdAt`: åˆ›å»ºæ—¶é—´
- `updatedAt`: æ›´æ–°æ—¶é—´

#### åˆ†é¡µä¿¡æ¯å­—æ®µ

- `total`: æ€»è®°å½•æ•°
- `page`: å½“å‰é¡µç 
- `pageSize`: æ¯é¡µæ•°é‡
- `totalPages`: æ€»é¡µæ•°
- `hasNextPage`: æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
- `hasPrevPage`: æ˜¯å¦æœ‰ä¸Šä¸€é¡µ

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### æ€§èƒ½ä¼˜åŒ–

1. **ä½¿ç”¨åˆ†é¡µ**ï¼šé¿å…è¿”å›è¿‡å¤šæ•°æ®ï¼Œå»ºè®® `pageSize` ä¸è¶…è¿‡ 50
2. **ç´¢å¼•å‹å¥½æŸ¥è¯¢**ï¼šä¼˜å…ˆä½¿ç”¨ç­‰äºã€åŒ…å«ç­‰ç´¢å¼•å‹å¥½çš„æ“ä½œç¬¦
3. **åˆç†ä½¿ç”¨æ­£åˆ™**ï¼šæ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢æ€§èƒ½è¾ƒä½ï¼Œè°¨æ…ä½¿ç”¨
4. **æ—¥æœŸèŒƒå›´é™åˆ¶**ï¼šé¿å…è¿‡å¤§çš„æ—¥æœŸèŒƒå›´æŸ¥è¯¢

### æœç´¢ç­–ç•¥

1. **æ™ºèƒ½æœç´¢**ï¼šè®©ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­æœç´¢æ¨¡å¼ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®š
2. **ç»„åˆæŸ¥è¯¢**ï¼šåˆç†ç»„åˆä¸åŒå­—æ®µå’Œæ“ä½œç¬¦å®ç°ç²¾ç¡®ç­›é€‰
3. **æ¸è¿›å¼æœç´¢**ï¼šä»å®½æ³›æ¡ä»¶å¼€å§‹ï¼Œé€æ­¥æ·»åŠ ç­›é€‰æ¡ä»¶
4. **ç¼“å­˜å‹å¥½**ï¼šç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶å¯ä»¥åˆ©ç”¨ç¼“å­˜æå‡æ€§èƒ½

### é”™è¯¯å¤„ç†

1. **å‚æ•°éªŒè¯**ï¼šç¡®ä¿æ—¥æœŸæ ¼å¼æ­£ç¡®ï¼Œæ•°å€¼èŒƒå›´åˆç†
2. **æ“ä½œç¬¦ä½¿ç”¨**ï¼šæ³¨æ„ä¸åŒå­—æ®µç±»å‹æ”¯æŒçš„æ“ä½œç¬¦
3. **åˆ†é¡µè¾¹ç•Œ**ï¼šæ³¨æ„é¡µç å’Œé¡µé¢å¤§å°çš„åˆç†èŒƒå›´
4. **æ­£åˆ™è¡¨è¾¾å¼**ï¼šç¡®ä¿æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•æ­£ç¡®

## ğŸ”§ æŠ€æœ¯å®ç°

### ç›¸å…³æ–‡ä»¶

- **Controller**: `src/modules/users/users.controller.ts`
- **Service**: `src/modules/users/users.service.ts`
- **Repository**: `src/modules/users/users.repository.ts`
- **DTO**: `src/modules/users/dto/find-users.dto.ts`
- **æœç´¢æ„å»ºå™¨**: `src/modules/users/utils/advanced-user-search-builder.util.ts`

### æœç´¢æ¡†æ¶

æœ¬åŠŸèƒ½åŸºäºé€šç”¨çš„é«˜çº§æœç´¢æ¡†æ¶å®ç°ï¼Œæ”¯æŒï¼š

- ç±»å‹å®‰å…¨çš„æ“ä½œç¬¦
- æ™ºèƒ½æœç´¢æ¨¡å¼åˆ¤æ–­
- å¯æ‰©å±•çš„å­—æ®µé…ç½®
- é«˜æ€§èƒ½çš„æŸ¥è¯¢æ„å»º

### æ‰©å±•åŠŸèƒ½

å¦‚éœ€æ·»åŠ æ–°çš„æœç´¢å­—æ®µæˆ–æ“ä½œç¬¦ï¼Œå¯ä»¥ï¼š

1. åœ¨ `FindUsersDto` ä¸­æ·»åŠ æ–°å­—æ®µ
2. åœ¨ `USER_FIELD_CONFIG` ä¸­é…ç½®å­—æ®µå±æ€§
3. ç³»ç»Ÿä¼šè‡ªåŠ¨æ”¯æŒæ–°å­—æ®µçš„æœç´¢åŠŸèƒ½

---

é€šè¿‡è¿™äº›é«˜çº§æœç´¢åŠŸèƒ½ï¼Œä½ å¯ä»¥å®ç°éå¸¸çµæ´»å’Œå¼ºå¤§çš„ç”¨æˆ·æ•°æ®ç­›é€‰å’ŒæŸ¥è¯¢ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒç›¸å…³ä»£ç å®ç°æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
