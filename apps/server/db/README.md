# 数据库管理 CLI 工具

这是一个交互式的数据库管理命令行工具，提供友好的用户界面来管理数据库相关的操作。

## 🚀 快速开始

### 启动交互式 CLI

```bash
pnpm db:cli
```

### 查看数据库状态

```bash
pnpm db:status
```

## 📋 功能特性

### 🗄️ 数据库管理

- **初始化数据库** - 格式化 schema + 生成客户端 + 推送架构
- **查看数据统计** - 显示数据库中的详细统计信息
- **验证数据完整性** - 检查数据完整性和一致性

### 🌱 种子数据管理

- **快速开发数据** - 一键生成开发环境测试数据
- **完整数据集** - 根据环境生成完整的测试数据
- **分模块数据生成** - 单独生成管理员、组织、用户、授权码、日志数据
- **智能清理** - 安全清理测试数据，可选保留管理员
- **环境适配** - 支持开发、测试、生产环境的不同数据策略

### 🔧 Prisma 工具集

- **格式化架构** - 自动格式化 schema.prisma 文件
- **生成客户端** - 生成 TypeScript 客户端代码
- **推送架构** - 将架构变更推送到数据库
- **Prisma Studio** - 启动可视化数据库管理界面
- **数据库重置** - 安全重置数据库结构

### 📊 状态监控

- **健康检查** - 全面的数据库和项目状态检查
- **连接测试** - 自动测试数据库连接状态
- **配置验证** - 检查必要的配置文件和环境变量

## 🎯 使用场景

### 日常开发

```bash
# 启动交互式工具，选择"快速开发数据"
pnpm db:cli

# 或直接命令行
pnpm db:quick
```

### 项目初始化

```bash
# 交互式初始化
pnpm db:cli
# 选择: 数据库管理 → 初始化数据库

# 或直接命令行
pnpm db:init
```

### 数据清理

```bash
# 交互式清理（推荐）
pnpm db:cli
# 选择: 种子数据管理 → 清理测试数据

# 可以选择是否保留管理员账号
```

### 状态检查

```bash
# 详细状态报告
pnpm db:status

# 或在交互式工具中选择"数据库状态检查"
pnpm db:cli
```

## 🎨 用户体验特性

### 📱 交互式界面

- **美观的菜单** - 使用图标和颜色区分不同功能
- **智能导航** - 分层菜单，可以返回上级
- **操作确认** - 危险操作需要用户确认
- **进度显示** - 长时间操作显示进度指示器

### 🛡️ 安全保护

- **操作确认** - 数据清理、重置等危险操作需要确认
- **参数验证** - 输入参数自动验证
- **错误处理** - 友好的错误信息和建议
- **中断处理** - 支持 Ctrl+C 优雅退出

### ⚡ 性能优化

- **命令缓存** - 避免重复的系统检查
- **并行执行** - 支持并行的数据库操作
- **超时控制** - 防止命令执行时间过长
- **内存管理** - 大量数据操作的内存优化

## 🔧 技术实现

### 核心依赖

- **inquirer** - 交互式命令行界面
- **chalk** - 彩色终端输出
- **consola** - 美观的日志输出
- **commander** - 命令行参数解析
- **table** - 表格格式化输出

### 架构设计

```
db/scripts/
├── utils.mjs      # 共享工具函数
├── cli.mjs        # 主交互式 CLI
├── status.mjs     # 状态检查脚本
└── README.md      # 使用文档
```

### 扩展性

- **模块化设计** - 易于添加新功能
- **配置驱动** - 通过配置管理命令和选项
- **插件系统** - 支持自定义扩展

## 📖 详细命令说明

### 交互模式选项

#### 🗄️ 数据库管理

- **初始化数据库** - 完整的数据库设置流程
- **查看数据统计** - 详细的数据分布信息
- **验证数据完整性** - 检查数据一致性

#### 🌱 种子数据管理

- **快速开发数据** - 适合日常开发的测试数据
- **完整数据集** - 可选择环境和自定义选项
- **分模块生成** - 按需生成特定类型的数据
- **清理功能** - 安全清理，支持选择性保留

#### 🔧 Prisma 工具

- **架构管理** - 格式化、生成、推送操作
- **可视化工具** - Prisma Studio 启动
- **数据库重置** - 带确认的安全重置

### 命令行模式

```bash
# 显示状态
pnpm db:cli --status

# 初始化数据库
pnpm db:cli --init

# 执行种子脚本
pnpm db:cli --seed quick

# 清理数据
pnpm db:cli --clean

# 显示统计
pnpm db:cli --stats
```

## 🤝 贡献指南

### 添加新功能

1. 在 `utils.mjs` 中添加相关工具函数
2. 在 `cli.mjs` 中添加菜单选项和处理逻辑
3. 更新 `DB_COMMANDS` 配置
4. 添加相应的文档说明

### 代码规范

- 使用 ES modules 语法
- 保持函数单一职责
- 添加适当的错误处理
- 遵循现有的代码风格

## 🆘 故障排除

### 常见问题

**Q: CLI 无法启动**

```bash
# 检查 Node.js 版本
node --version

# 重新安装依赖
pnpm install
```

**Q: 数据库连接失败**

```bash
# 检查数据库服务
pnpm db:dev:up

# 检查环境配置
cat .env
```

**Q: Prisma 客户端错误**

```bash
# 重新生成客户端
pnpm prisma:generate

# 检查 schema 文件
pnpm prisma:format
```

### 获取帮助

- 运行 `pnpm db:cli` 查看所有可用选项
- 运行 `pnpm db:status` 进行全面状态检查
- 查看项目文档了解更多信息
