# 快速上手

本系列文章将带你系统学习 Nest 的核心基础知识。为帮助你快速熟悉 Nest 应用的基本构建模块，我们将通过搭建一个基础的 CRUD 应用，涵盖入门阶段常见的功能和特性。

## 开发语言

我们热爱 TypeScript，也同样欣赏 Node.js 的强大生态。Nest 天生支持 TypeScript，同时也兼容原生 JavaScript。由于 Nest 充分利用了现代语言特性，如果你选择使用 JavaScript，建议搭配 [Babel 编译器](https://babeljs.io/)，以确保良好的兼容性与开发体验。

## 环境准备

请确保你的操作系统已安装 [Node.js](https://nodejs.org)（版本 >= 20）。

## 创建新项目

使用 [Nest CLI](/cli/overview) 脚手架工具可以轻松创建一个新项目。在开始之前，请确保已安装好 [npm](https://www.npmjs.com/)，然后在终端中运行以下命令，即可初始化一个新的 Nest 项目：

```bash
$ npm i -g @nestjs/cli
# [!code word:project-name:1]
$ nest new project-name
#          ^^^^^^^^^^^^ 这里可以填写你想要的项目名称
```

<CalloutInfo>
  如果你希望项目启用 TypeScript [严格模式](https://www.typescriptlang.org/tsconfig#strict)，可在
  `nest new` 命令中添加 `--strict` 参数。
</CalloutInfo>

上述命令会创建 `project-name` 目录，自动安装依赖和部分基础文件，并生成 `src/` 目录及多个核心文件。

<FileTree
  data={[
    {
      name: 'src',
      children: [
        { name: 'app.controller.spec.ts' },
        { name: 'app.controller.ts' },
        { name: 'app.module.ts' },
        { name: 'app.service.ts' },
        { name: 'main.ts' },
      ],
    },
  ]}
/>

这些核心文件的作用如下：

| 文件                     | 描述                                                            |
| ------------------------ | --------------------------------------------------------------- |
| `app.controller.ts`      | 基础控制器，包含一个路由。                                      |
| `app.controller.spec.ts` | 控制器的单元测试文件。                                          |
| `app.module.ts`          | 应用的根模块。                                                  |
| `app.service.ts`         | 基础服务，包含一个方法。                                        |
| `main.ts`                | 应用的入口文件，使用核心函数 `NestFactory` 创建 Nest 应用实例。 |

`main.ts` 文件包含一个异步函数，用于**启动应用**：

```ts filename='main.ts'
import { NestFactory } from '@nestjs/core'
import { AppModule } from './app.module'

// [!code highlight:4]
async function bootstrap() {
  const app = await NestFactory.create(AppModule)
  await app.listen(process.env.PORT ?? 3000)
}

bootstrap()
```

我们通过核心类 `NestFactory` 创建 Nest 应用实例。`NestFactory` 提供了用于生成应用对象的静态方法，其中 `create()` 方法会返回一个实现了 `INestApplication` 接口的应用实例。该对象包含丰富的方法，后续章节将会详细介绍。在上述 `main.ts` 示例中，我们仅启动了一个 HTTP 监听器，使应用能够接收和处理 HTTP 请求。

通过 Nest CLI 脚手架创建的项目，默认采用模块化的目录结构，鼓励开发者将每个功能模块划分到独立的目录中。每个模块通常包含其控制器（Controller）、服务（Service）、模块定义（Module）等文件，从而实现高内聚、低耦合的设计。这种结构不仅符合 Nest 的设计理念，也有助于团队协作、代码维护与后期扩展，是构建可规模化应用的最佳实践之一。

<CalloutInfo>
  默认情况下，如果应用创建过程中发生错误，程序会以退出码 `1` 终止运行。如果你希望在出错时抛出异常而不是立即退出程序，可以通过设置 `abortOnError: false` 来关闭该行为：`NestFactory.create(AppModule, { abortOnError: false })`
</CalloutInfo>

## 多平台支持

Nest 致力于成为一个与平台无关的框架，这种平台无关性让开发者能够构建可复用的逻辑模块，并在不同类型的应用中灵活复用。从技术层面看，只要提供相应的适配器，Nest 就可以与任意 Node.js HTTP 框架集成。目前，Nest 原生支持两种主流平台：[express](https://expressjs.com/) 和 [fastify](https://www.fastify.io/)，开发者可以根据实际需求选择最合适的方案。

| 平台               | 描述                                                                                                                                                                                                         |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `platform-express` | Express 是一个非常流行的轻量级 Web 框架，不仅稳定可靠，而且社区资源丰富，已经在各种生产环境中被广泛使用。Nest 默认使用 `@nestjs/platform-express` 适配器，开箱即用，大多数情况下你无需额外配置即可直接开发。 |
| `platform-fastify` | Fastify 是一个主打高性能、低开销的 Web 框架，专注于追求极致的执行效率和响应速度。如果你对性能有更高要求，可以考虑使用 Fastify。具体使用方式可以参考这篇[指南](/techniques/performance)。                     |

无论你选择哪种平台，Nest 都会为其提供对应的应用接口，比如 `NestExpressApplication` 或 `NestFastifyApplication`。

在使用 `NestFactory.create()` 创建应用实例时，如果你传入了类型参数（如下所示），返回的 app 对象就会拥有该平台特有的方法。不过，除非你需要调用底层平台的 API，大多数情况下其实不需要指定这个类型。

```ts filename='main.ts'
const app = await NestFactory.create<NestExpressApplication>(AppModule)
```

## 启动与调试

依赖安装完成后，只需在终端中运行以下命令即可启动应用，并开始监听 HTTP 请求：

```bash
$ npm run start
```

<CalloutInfo>
<div>
  如果你希望加快开发时的构建速度（可提升约 20 倍），可以在启动命令中添加 `-b swc` 参数，使用 [SWC 构建器](/recipes/swc)：
</div>

```bash
$ npm run start -- -b swc
```

SWC 是一个用 Rust 编写的高速编译器，能显著提升 TypeScript 转译和项目构建的效率，尤其适合开发阶段使用。

</CalloutInfo>

该命令会启动一个 HTTP 服务器，监听 `src/main.ts` 文件中定义的端口。应用启动后，在浏览器访问 `http://localhost:3000/`，你将看到 `Hello World!` 的响应。

如需在开发过程中监听文件变更并自动重载服务，可以使用以下命令：

```bash
$ npm run start:dev
```

该命令会自动监控文件变更，实时编译并重启服务器。

## 代码规范与格式化工具

Nest CLI 旨在为大型项目提供稳定、高效的开发工作流。因此，默认生成的项目中已经集成了代码检查工具（ESLint）和代码格式化工具（Prettier）。

- [ESLint](https://eslint.org/) 用于检测代码中的潜在错误、不一致写法或不符合规范的代码风格。
- [Prettier](https://prettier.io/) 用于统一代码的格式，使团队协作更流畅，代码更易于阅读和维护。

<CalloutInfo>
  不清楚这两者的区别？你可以点击[这里](https://prettier.io/docs/en/comparison.html)了解代码格式化工具和检查工具的具体作用。
</CalloutInfo>

为了最大程度确保项目的稳定性和可扩展性，Nest 默认集成了基础的 ESLint 和 Prettier CLI 工具。这些工具天然支持通过官方扩展与主流 IDE（如 VS Code）深度集成，提供良好的开发体验。

此外，对于不依赖 IDE 的无头环境（如持续集成、Git hooks 等场景），Nest 项目也内置了可直接使用的 npm 脚本，方便在命令行中执行代码检查和格式化任务：

```bash
# 使用 ESLint 检查代码
$ npm run lint

# 使用 Prettier 格式化代码
$ npm run format
```
